(function(t){function e(e){for(var n,s,r=e[0],l=e[1],c=e[2],p=0,d=[];p<r.length;p++)s=r[p],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(d.length)d.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],n=!0,r=1;r<a.length;r++){var l=a[r];0!==i[l]&&(n=!1)}n&&(o.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},i={app:0},o=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},1:function(t,e){},2:function(t,e){},"2dd0":function(t,e,a){"use strict";a("e186")},3:function(t,e){},4:function(t,e){},5:function(t,e){},"56d7":function(t,e,a){"use strict";a.r(e);var n=a("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container",attrs:{id:"app"}},[a("h1",[t._v("OBIS - NMI Dashboard")]),a("Broker"),a("div",{staticClass:"row chart-cc"},[a("b-button",{staticStyle:{cursor:"default"},attrs:{size:"sm",variant:"outline-light"}},[a("b-icon",{staticClass:"icon-button",attrs:{icon:"cloud-upload"},on:{click:function(e){return t.showModal("nmi_left")}}}),a("b-icon",{staticClass:"icon-button",attrs:{icon:"tools"},on:{click:function(e){return t.showModal("nmi_left")}}})],1),a("div",{staticClass:"col-8 border"},[a("StockChart",{attrs:{device:t.nmi_left}})],1),a("div",{staticClass:"col-4 border"},[a("Gauge",{attrs:{gaugeTitle:t.gaugeTitle,device:t.nmi_left}}),a("ControlSlider",{attrs:{sliderLabel:t.sliderText,device:t.nmi_left}})],1)],1),a("div",{staticClass:"row chart-cc"},[a("b-button",{staticStyle:{cursor:"default"},attrs:{size:"sm",variant:"outline-light"}},[a("b-icon",{staticClass:"icon-button",attrs:{icon:"cloud-upload"},on:{click:function(e){return t.showModal("nmi_right")}}}),a("b-icon",{staticClass:"icon-button",attrs:{icon:"tools"},on:{click:function(e){return t.showModal("nmi_right")}}})],1),a("div",{staticClass:"col-8 border"},[a("StockChart",{attrs:{device:t.nmi_right}})],1),a("div",{staticClass:"col-4 border"},[a("Gauge",{attrs:{gaugeTitle:t.gaugeTitle,device:t.nmi_right}}),a("ControlSlider",{attrs:{sliderLabel:t.sliderText,device:t.nmi_right}})],1)],1),a("Setting",{ref:"Setting"})],1)},o=[],s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{ref:"modal",staticClass:"modal fade",class:{show:t.show,"d-block":t.active},attrs:{tabindex:"-1",role:"dialog"}},[a("div",{staticClass:"modal-dialog modal-dialog-centered modal-lg",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[t._v("Device configuration: "+t._s(t.device))]),a("div",{staticClass:"modal-body container",staticStyle:{"max-width":"95%"}},[a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Device Name"}},[a("b-form-input",{attrs:{id:"deviceName"},model:{value:t.device,callback:function(e){t.device=e},expression:"device"}})],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Organization"}},[a("b-form-input",{attrs:{id:"organization"},model:{value:t.organization,callback:function(e){t.organization=e},expression:"organization"}})],1),a("br"),a("label",[t._v("Influx DB")]),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Bucket"}},[a("b-form-input",{model:{value:t.bucket,callback:function(e){t.bucket=e},expression:"bucket"}})],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Token"}},[a("b-form-input",{model:{value:t.token,callback:function(e){t.token=e},expression:"token"}})],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"DB Port"}},[a("b-form-input",{attrs:{type:"number",min:"1",max:"9999"},model:{value:t.DBPort,callback:function(e){t.DBPort=e},expression:"DBPort"}})],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"MQTT Port"}},[a("b-form-input",{attrs:{type:"number",min:"1",max:"9999"},model:{value:t.MQTTPort,callback:function(e){t.MQTTPort=e},expression:"MQTTPort"}})],1),a("br"),a("label",{attrs:{for:"inputTime"}},[t._v("Sensor setup")]),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Acquisition time"}},[a("b-form-input",{attrs:{type:"range",min:"100",max:"600",step:"100",id:"inputTime"},model:{value:t.aTime,callback:function(e){t.aTime=e},expression:"aTime"}}),a("div",{staticStyle:{"margin-top":"5px","margin-left":"10px"}},[t._v(t._s(t.aTime))])],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Amplifier gain"}},[a("b-form-select",{staticClass:"inputBox",attrs:{options:t.gainOptions},model:{value:t.aGain,callback:function(e){t.aGain=e},expression:"aGain"}}),a("div",{staticStyle:{"margin-top":"5px","margin-left":"10px"}},[t._v(t._s(t.aGain))])],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Persistent interrupt"}},[a("b-form-select",{staticClass:"inputBox",attrs:{options:t.pintOptions},model:{value:t.pIntType,callback:function(e){t.pIntType=e},expression:"pIntType"}}),a("div",{staticStyle:{"margin-top":"5px","margin-left":"10px"}},[t._v(t._s(t.pIntType))])],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"LOW threshold"}},[a("b-form-input",{attrs:{type:"number",min:"0",max:"65535"},model:{value:t.pIntLowThr,callback:function(e){t.pIntLowThr=e},expression:"pIntLowThr"}})],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"HIGH threshold"}},[a("b-form-input",{attrs:{type:"number",min:"0",max:"65535"},model:{value:t.pIntHighThr,callback:function(e){t.pIntHighThr=e},expression:"pIntHighThr"}})],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Non persistent interrupt (LOW)"}},[a("b-form-input",{attrs:{type:"number",min:"0",max:"65535"},model:{value:t.npIntLowThr,callback:function(e){t.npIntLowThr=e},expression:"npIntLowThr"}})],1),a("b-input-group",{staticClass:"mt-3",attrs:{prepend:"Non persistent interrupt (HIGH)"}},[a("b-form-input",{attrs:{type:"number",min:"0",max:"65535"},model:{value:t.npIntHighThr,callback:function(e){t.npIntHighThr=e},expression:"npIntHighThr"}})],1),a("div",{staticClass:"modal-footer"},[a("b-button",{attrs:{variant:"outline-primary","data-dismiss":"modal"},on:{click:t.toggleModal}},[t._v("Cancel")]),a("b-button",{attrs:{variant:"outline-primary"},on:{click:t.saveConfig}},[t._v("Save configuration")])],1)],1)])])]),t.active?a("div",{staticClass:"modal-backdrop fade show"}):t._e()])},r=[],l=a("bc3a"),c=a.n(l),u={data(){return{active:!1,show:!1,device:"Device",organization:"work",bucket:"measures",token:"token",hostIP:"190.100.x.x",DBPort:8086,MQTTPort:1883,aTime:10,aGain:0,gainOptions:[{value:null,text:"Please select an option"},{value:0,text:"LOW gain"},{value:1,text:"MEDIUM gain"},{value:2,text:"HIGH gain"},{value:3,text:"MAX gain"}],pintOptions:[{value:null,text:"Please select an option"},{value:0,text:"Every ALS cycle generate interrupt"},{value:1,text:"Any value outside of threshold range"},{value:2,text:"2 consecutive values out of range"},{value:3,text:"3 consecutive values out of range"},{value:4,text:"5 consecutive values out of range"},{value:5,text:"10 consecutive values out of range"},{value:6,text:"15 consecutive values out of range"},{value:7,text:"20 consecutive values out of range"},{value:8,text:"25 consecutive values out of range"},{value:9,text:"30 consecutive values out of range"},{value:10,text:"35 consecutive values out of range"},{value:11,text:"40 consecutive values out of range"},{value:12,text:"45 consecutive values out of range"},{value:13,text:"50 consecutive values out of range"},{value:14,text:"55 consecutive values out of range"},{value:15,text:"60 consecutive values out of range"}],pIntType:100,pIntLowThr:50,pIntHighThr:50,npIntLowThr:100,npIntHighThr:100}},methods:{setDevice(t){this.device=t,console.log(t)},toggleModal(){const t=document.querySelector("body");this.active=!this.active,this.active?(this.loadConfig(),t.classList.add("modal-open")):t.classList.remove("modal-open"),setTimeout(()=>this.show=!this.show,10)},async loadConfig(){try{const t=await c.a.post(`http://${location.hostname}/getConfig`,{device:this.device}),e=t.data;this.device=e["device"],this.bucket=e["bucket"],this.organization=e["organization"],this.token=e["token"],this.hostIP=e["hostIP"],this.DBPort=e["DBPort"],this.MQTTPort=e["MQTTPort"],this.aGain=e["aGain"],this.aTime=e["aTime"],this.pIntType=e["pIntType"],this.pIntLowThr=e["pIntLowThr"],this.pIntHighThr=e["pIntHighThr"],this.npIntLowThr=e["npIntLowThr"],this.npIntHighThr=e["npIntHighThr"],console.log(e)}catch(t){console.log(t)}},async saveConfig(){try{const t=await c.a.post(`http://${location.hostname}/setConfig`,{device:this.device,aTime:parseInt(this.aTime),aGain:parseInt(this.aGain),pIntType:parseInt(this.pIntType),pIntLowThr:parseInt(this.pIntLowThr),pIntHighThr:parseInt(this.pIntHighThr),npIntLowThr:parseInt(this.npIntLowThr),npIntHighThr:parseInt(this.npIntHighThr)});console.log(t)}catch(t){console.log(t)}}}},p=u,d=(a("b2f8"),a("2877")),h=Object(d["a"])(p,s,r,!1,null,"f02e0f10",null),v=h.exports,g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("highcharts",{ref:"chart_nmi_left",attrs:{options:t.chartOptions,updateArgs:t.updateArgs,"constructor-type":"stockChart"}})],1)},m=[],f=a("ea7f"),b=a.n(f),x=a("37d8"),T=a.n(x),y=a("0319"),w=a.n(y),I=a("d68a"),C=a.n(I);T()(b.a),w()(b.a),C()(b.a);var _={props:{device:String},methods:{async getData(){const t=this.$refs.chart_nmi_left.chart;c.a.get(`http://${this.host}/getData?device=${this.device}&range=${this.dataRange}&window=10`).then(e=>{e.data.forEach(e=>{const a=[new Date(e._time).getTime(),e._value];t.series[e.table].addPoint(a,!1,!1)}),t.redraw(),this.dataRange="-10s",setTimeout(this.getData,1e4)})}},created(){const t=this.device.split("_")[1];this.chartOptions.title.text="Light Intensity NMI-"+t},mounted(){this.getData()},data(){return{host:location.hostname,maxPoints:20,dataRange:"-1d",updateArgs:[!0,!0,{duration:100}],chartOptions:{chart:{zoomType:"x",height:380},title:{text:"",align:"right",x:-100,y:20,floating:!0},xAxis:{type:"datetime"},legend:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.y:.2f}</b><br/>",shared:!0},rangeSelector:{inputEnabled:!1,selected:3,buttons:[{count:5,type:"minute",text:"5 m"},{count:15,type:"minute",text:"15 m"},{count:60,type:"minute",text:"60 m"},{count:1140,type:"minute",text:"1 d"},{type:"all",text:"all"}]},navigator:{margin:5,adaptToUpdatedData:!0,height:20,outlineWidth:0,maskFill:"rgba(0, 0, 0, 0.2)",series:{type:"line",color:"#bbb"}},scrollbar:{enabled:!1},plotOptions:{area:{lineWidth:1,fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,b.a.getOptions().colors[4]],[1,b.a.color(b.a.getOptions().colors[1]).setOpacity(0).get("rgba")]]}}},series:[{color:"red",type:"area",name:"Infrared light intensity",data:[]},{color:"blue",type:"area",name:"Visible light intensity",data:[]}]}}}},k=_,O=(a("e3e9"),Object(d["a"])(k,g,m,!1,null,null,null)),S=O.exports,M=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mqtt-message"})},P=[],L=a("e7fc"),H=a.n(L);const $=new n["default"],D=location.hostname;var B={data(){return{lastMessage:"",status:"Not connected",port:8883,subscription:{topic:"device/#",qos:1},publish:{topic:"device/browser",qos:1,payload:'{ "msg": "Hello, I am browser." }'},client:{connected:!1},subscribeSuccess:!1}},mounted(){return this.createConnection()},methods:{createConnection(){const t=`mqtt://${D}:${this.port}`;console.log(t);try{console.log(t),this.client=H.a.connect(t)}catch(n){console.log("mqtt.connect error",n)}this.client.on("connect",()=>{console.log("Connection succeeded!"),this.status="Connection succeeded!"}),this.client.on("error",t=>{console.log("Connection failed",t)}),this.client.on("message",(t,e)=>{let a=JSON.parse(e);const n=(new Date).toLocaleTimeString("it-IT");this.lastMessage=`${n} > Received ${e} on topic ${t}`,$.$emit(""+t,a.value)});const{topic:e,qos:a}=this.subscription;this.client.subscribe(e,{qos:a},t=>{t?console.log("Subscribe to topics error",t):(this.subscribeSuccess=!0,console.log("Subscribed to topics of interest"))})}},props:{inMsg:String}},z=B,N=Object(d["a"])(z,M,P,!1,null,null,null),F=N.exports,G=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("label",{attrs:{for:"volt-control"}},[t._v(t._s(t.sliderLabel))]),a("div",{staticClass:"input-group mb-3",attrs:{id:"volt-control"}},[a("button",{staticClass:"btn btn-outline-secondary sm plus-minus",on:{click:t.minus}},[a("svg",{staticClass:"bi bi-dash-square",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16"}},[a("path",{attrs:{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}}),a("path",{attrs:{d:"M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"}})])]),a("div",{staticClass:"range-wrap"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"value"}],ref:"mySlider",attrs:{id:"range",type:"range",min:"0",max:"100",step:"1"},domProps:{value:t.value},on:{change:t.storeData,__r:function(e){t.value=e.target.value}}}),a("div",{staticClass:"range-value",style:{left:t.leftTip+"%"},attrs:{id:"rangeV"}},[a("span",[t._v(t._s(t.value))])])]),a("button",{staticClass:"btn btn-outline-secondary sm plus-minus",on:{click:t.plus}},[a("svg",{staticClass:"bi bi-plus-square",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16"}},[a("path",{attrs:{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}}),a("path",{attrs:{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}})])])])])},A=[],j={props:["device","sliderLabel"],data(){return{leftTip:20,value:24}},mounted(){this.getData()},watch:{value(){this.value=Math.max(0,this.value),this.value=Math.min(100,this.value);const t=Number(100*this.value/100);this.leftTip=t+(3-.06*t),this.storeData()}},methods:{plus(){this.value+=1},minus(){this.value-=1},async getData(){try{const t=await c.a.get(`http://${location.hostname}/getParam?device=${this.device}&param=dac_output`);this.value=Number(t.data[0]._value)}catch(t){console.log(t)}},async storeData(){try{const t=await c.a.get(`http://${location.hostname}/setParam?device=${this.device}&param=dac_output&value=${this.value}`);console.log(t)}catch(t){console.log(t)}}}},q=j,E=(a("b5e1"),Object(d["a"])(q,G,A,!1,null,"26114e5c",null)),R=E.exports,V=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box"},[a("div",[a("highcharts",{ref:"gauge_nmi",attrs:{options:t.chartOptions}})],1)])},Q=[],W=a("4452"),J=a.n(W),U=a("33c6"),X=a.n(U);X()(b.a);var K={name:"voltage",props:{gaugeTitle:String,device:String},components:{highcharts:W["Chart"]},created(){this.topicName=`device/${this.device}/adc_value`;const t=this.device.split("_")[1];this.chartOptions.yAxis[0].title.text=`<span style="font-size:12px">NMI - ${t}</span>`,this.chartOptions.title.text=this.gaugeTitle},mounted(){$.$on(this.topicName,t=>{const e=JSON.parse(t);this.chartOptions.series[0].data=[e]})},data(){return{topicName:String,chartOptions:{chart:{type:"gauge",plotBorderWidth:1,plotBackgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[.1,"#FFFFFF"],[1,"#FFF4C6"]]},plotBackgroundImage:null,plotShadow:!0,height:270,width:300},title:{text:"Output Voltage Level"},pane:[{startAngle:-90,endAngle:90,background:null,center:["50%","60%"]}],exporting:{enabled:!1},tooltip:{enabled:!1},yAxis:[{min:18,max:24,minorTickPosition:"outside",tickPosition:"outside",minorTickInterval:"auto",minorTickLength:7,tickPixelInterval:30,tickWidth:3,tickColor:"#666",labels:{step:1,rotation:"auto",distance:16},plotBands:[{from:19,to:21,color:"#C0FF16",innerRadius:"90%",outerRadius:"100%"},{from:21,to:22,color:"#FFFF16",innerRadius:"90%",outerRadius:"100%"},{from:22,to:24,color:"#C0231688",innerRadius:"10%",outerRadius:"100%"}],pane:0,title:{text:'<span style="font-size:12px">Title</span>',y:110}}],plotOptions:{gauge:{dial:{radius:"100%"}}},series:[{name:"Voltage setup",data:[20],yAxis:0}]}}}},Y=K,Z=Object(d["a"])(Y,V,Q,!1,null,null,null),tt=Z.exports;document.title="OBIS - NMI Dashboard";var et={name:"app",components:{StockChart:S,Gauge:tt,ControlSlider:R,Broker:F,Setting:v},methods:{showModal(t){this.$refs.Setting.setDevice(t),this.$refs.Setting.toggleModal()}},data(){return{sliderText:"PSU Output Power ",gaugeTitle:"Halogen Lamp Voltage",nmi_left:"NMI_LEFT",nmi_right:"NMI_RIGHT"}}},at=et,nt=(a("2dd0"),Object(d["a"])(at,i,o,!1,null,"70092677",null)),it=nt.exports,ot=(a("7b17"),a("9607"),a("b1e0")),st=a("5f5b");a("5df9");n["default"].use(ot["a"]),n["default"].use(st["a"]),n["default"].use(J.a),n["default"].config.productionTip=!1,new n["default"]({el:"#app",render:t=>t(it)}).$mount("#app")},6:function(t,e){},7:function(t,e){},8:function(t,e){},9607:function(t,e,a){},a0dc:function(t,e,a){},a39f:function(t,e,a){},a50e:function(t,e,a){},b2f8:function(t,e,a){"use strict";a("a39f")},b5e1:function(t,e,a){"use strict";a("a50e")},e186:function(t,e,a){},e3e9:function(t,e,a){"use strict";a("a0dc")}});
//# sourceMappingURL=app.f85249eb.js.map